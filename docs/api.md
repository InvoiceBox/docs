---
layout: default
nav_order: 3
title: "Работа с API"
permalink: /docs/api/
toc: true
---

InvoiceBox API представляет собой набор HTTP ресурсов, к которым можно обращаться следующими HTTP методами: `GET`, `POST`, `PUT`, `DELETE`.

### Базовый URL
- https://api.stage.k8s.invbox.ru - для тестового окружения
- https://api.invbox.ru - для продуктового окружения

### Форматы данных
Тело запроса, если оно требуется, должно быть в формате `json`, так же обязательно наличие заголовка `Content-Type: application/json`. 
Во всех запросах обязателен заголовок, указывающий на формат ответа: `Accept: application/json`

### Структура ответа
Все ответы API приходят в формате json. 
В случае положительного ответа данные приходят в свойстве `data` основного объекта

Пример запроса получения единичной сущности:
```json
{
  "data": {"id": 1, "title": "New title"}
}
```

Пример запроса получения коллекции сущностей:
```json
{
  "data": [
      {"id": 1, "title": "Apple"},
      {"id": 2, "title": "Orange"},
      {"id": 3, "title": "Passion fruit"}
    ]
}
```

В случае ошибки, код ответа будет >= 400, а ответ будет содержать свойство error
```json
{
  "error":{
    "message": "Error",
    "code": "unauthorized"
  }
}
```

### Аутентификация
Для всех запросов к API обязательно должен присутствовать авторизационный токен, который можно получить после регистрации магазина.
Пример: `Authorization: Bearer b37c4c689295904ed21eee5d9a48d42e`

Для проверки работы аутентификации можно выполнить тестовый метод:
```
GET /a1/api/security/auth
Accept: application/json
Authorization: Bearer b37c4c689295904ed21eee5d9a48d42e
```

Если данные верны, то в ответ придет ответ со статусом 200 и телом:
```json
{
  "data": {"userId": "01771533-8e75-3234-8e3d-9213ae2d7c52"}
}
```

### Фильтры на выборки:
Запросы на получение списка сущностей поддерживают возможность применения следующих фильтров:
- по  соответствию поля заданному значению, пример `status=created` или по массиву значений: `status[]=created&status[]=completed`
- с применением операторов сравнения:

  | оператор| описание          |  типы значений   | пример
  | ------- |-------------------| -----------------|-------
  | _eq     | равно             | все типы         | `status[_eq]=created`, эквивалент `status=created`
  | _ne     | не равно          | все типы         | `status[_ne]=created`
  | _gt     | строго больше     | int, float       | `amount[_gt]=1000`
  | _ge     | больше или равно  | int, float       | `amount[_ge]=1000`
  | _lt     | строго меньше     | int, float       | `amount[_lt]=1000`
  | _le     | меньше или равно  | int, float       | `amount[_le]=1000`
  | _start  | начинается с      | string           | `name[_start]=John`

### Сортировки выборок
Для сортировки данных используется параметр `_order`. Ключом которого является имя свойства объекта, а значение - порядок сортировки. Сортировку можно проводить по нескольким полям
пример: `_order[categoryId]=asc&_order[name]=desc`

### Пагинация
Для постраничного получения данных необходимо задать два параметра `pageSize` - количество элементов на странице и `page` - номер страницы, которую необходимо получить, пример `pageSize=5&page=2`
если не указывается `pageSize`, то по умолчанию оно принимает значение 30

### Получение дополнительных данных в запросе
Описание в разработке
