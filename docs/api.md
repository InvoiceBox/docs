---
layout: default
nav_order: 4
title: "Подключение к API"
---

# Подключение к API

API Инвойсбокс представляет собой набор HTTP ресурсов, к которым можно обращаться следующими HTTP методами: `GET`, `POST`, `PUT`, `DELETE`.

### Базовые URL

- https://api.invbox.ru - для продуктового окружения.
- https://api.stage.invbox.ru - для тестового окружения. Используется только в том случае, если для магазина было оформлено отдельное тестовое окружение.

### Форматы данных

Тело запроса, если оно требуется, должно быть в формате `json`, кодировка UTF-8.
Также обязательно наличие HTTP заголовка `Content-Type: application/json`. 
Во всех запросах обязателен заголовок, указывающий на формат ответа: `Accept: application/json`.
В случае использование механизма подписи запроса, подпись запроса должна быть передана в заголовке: `X-Signature: ...`.

:warning: Наименования параметров, заголовков и свойств объектов во всех запросах чувствительны к регистру.


### Структура ответа

Все ответы возвращаются в формате `json`. 
В случае положительного ответа, данные приходят в свойстве `data` основного объекта.

Пример запроса получения единичной сущности:
```json
{
  "data": {"id": 1, "title": "New title"}
}
```

Пример запроса получения коллекции сущностей:
```json
{
  "data": [
      {"id": 1, "title": "Apple"},
      {"id": 2, "title": "Orange"},
      {"id": 3, "title": "Passion fruit"}
    ]
}
```

В случае ошибки, код ответа HTTP будет >= 400, а ответ будет содержать свойство `error`:
```json
{
  "error":{
    "message": "Error",
    "code": "unauthorized"
  }
}
```

### Аутентификация

Для всех запросов к API обязательно должен присутствовать авторизационный токен, который можно получить после регистрации Магазина.
Пример: `Authorization: Bearer b37c4c689295904ed21eee5d9a48d42e`

:warning: Авторизационный токен используется для аутентификации в сервисе, он должен храниться в защищенном виде и месте.

Для проверки работы аутентификации можно выполнить тестовый метод:
```
GET /v3/security/api/auth/auth
Accept: application/json
Authorization: Bearer b37c4c689295904ed21eee5d9a48d42e
```

Если данные верны, то в ответ будет содержать HTTP код 200 и тело:
```json
{
  "data": {"userId": "01771533-8e75-3234-8e3d-9213ae2d7c52"}
}
```

### Фильтры на выборки:

Запросы на получение списка сущностей поддерживают возможность применения следующих фильтров:
- по соответствию поля заданному значению, например `status=created`
- по массиву значений: `status[]=created&status[]=completed`
- с применением операторов сравнения:

  | оператор| описание          |  типы значений   | пример
  | ------- |-------------------| -----------------|-------
  | _eq     | равно             | все типы         | `status[_eq]=created`, эквивалент `status=created`
  | _ne     | не равно          | все типы         | `status[_ne]=created`
  | _gt     | строго больше     | int, float       | `amount[_gt]=1000`
  | _ge     | больше или равно  | int, float       | `amount[_ge]=1000`
  | _lt     | строго меньше     | int, float       | `amount[_lt]=1000`
  | _le     | меньше или равно  | int, float       | `amount[_le]=1000`
  | _start  | начинается с      | string           | `name[_start]=John`

### Сортировки выборок

Для сортировки данных используется параметр `_order`. Ключом которого является имя свойства объекта,
а значение - порядок сортировки. Сортировку можно проводить по нескольким полям, например:
`_order[categoryId]=asc&_order[name]=desc`

### Постраничный вывод

Для постраничного получения данных необходимо задать два параметра `pageSize` - количество элементов
на странице и `page` - номер страницы, которую необходимо получить, например `pageSize=5&page=2`
если не указывается `pageSize`, то по умолчанию оно принимает значение 30.

---

[Читать далее &raquo;](/docs/api){: .btn .btn-primary .fs-5 .mb-4 .mb-md-0 .mr-2 }
