---
layout: default
nav_order: 1
title: "По-умолчанию"
parent: "Обработка уведомлений"
---

# Уведомление по-умолчанию

Если в настройках Магазина была активирована опция отправки автоматических уведомлений о смене
статуса Заказа, то при поступлении оплаты в пользу Заказа, система &laquo;ИнвойсБокс&raquo;
осуществит запрос на специальный URL, который указан в настройках Магазина.

На указанный URL будет осуществлен `POST` запрос в теле которого будет находиться объект [OrderNotification](#ordernotification).

## OrderNotification

| Свойство        | Обязательное | Тип         | Описание |
| --------------- | -------------|------------ | -------- |
| id              | да           | string      | Идентификатор заказа в системе &laquo;ИнвойсБокс&raquo;, например: `01771534-1a57-f184-dee3-ebeb91dded75`
| status          | да           | string enum | Статус заказа, например: `completed`
| merchantId      | да           | string      | Идентификатор магазина, например: `01771534-1a57-f184-dee3-ebeb91dded76`
| merchantOrderId | да           | string      | Идентификатор заказа в учётной системе магазина, например: `O-12345`
| amount          | да           | float       | Сумма заказа, например: `19658.45`
| currencyId      | да           | string enum | Валюта заказа, например: `RUB`
| createdAt       | да           | datetime    | Дата создания заказа, например: `2020-12-22T00:00:00+00:00`


Заказ считается оплаченным, если его статус равен `completed`. В этом случае Магазин должен сверить
сумму Заказа в запросе с суммой Заказа в своей системе учёта. Если не совпадает, в обработке запроса
нужно отказать и вернуть ошибку.

# Формат ответа

В случае успешной обработки запроса-уведомления веб-сервис Магазина должен вернуть объект [NotificationSuccess](#notificationsuccess). 

#### NotificationSuccess

| Свойство        | Обязательное | Тип         | Описание |
| --------------- | -------------|------------ | -------- |
| status          | да           | string      | В случе успешной обработки возможно только одно значение - `success`

Пример объекта NotificationSuccess:
```json 
{"status":"success"}
```

В случае ошибки ожидается объект [NotificationError](#notificationerror). В зависимости от кода ошибки &laquo;ИнвойсБокс&raquo; может отправлять повторные нотификации.

#### NotificationError

| Свойство        | Обязательное | Тип         | Описание |
| --------------- | -------------|------------ | -------- |
| status          | да           | string enum | В случае ошибки обработки запроса возможно только одно значение - `error`
| code            | да           | string enum | Код ошибки - значение из справочника [NotificationErrorCode](#notificationerrorcode) 
| message         | нет          | string      | Детальное описание ошибки в текстовом формате


#### NotificationErrorCode

| Код ошибки      | Повторные нотификации | Описание |
| --------------- | --------------------- | -------- |
|`out_of_service` | да                    | Техническая ошибка обработки запроса веб сервером Магазина
|`wrong_amount`   | нет                   | Ошибка сверки сумм заказа в учетной системе Магазина и системы &laquo;ИнвойсБокс&raquo;
|`already_payd`   | нет                   | Заказ уже оплачен
|`not_found`      | нет                   | Заказ не найден в учетной системе Магазина

Если системе &laquo;ИнвойсБокс&raquo; не удалось получить валидный ответ от Магазинна, а так же если HTTP ответа сервера >= 500, то ответ приравниваться валидному ответу со статусом `out_of_service`

# Время выполнения запроса

Существует лимит ожидания ответа от веб-сервера Магазина на запросы уведомления, который составляет 20 секунд.
Запросы отрабатывающие дольше этого значения будут приравниваться валидному ответу со статусом `out_of_service` 

# Повторное выполнение запросов

Если веб-сервис магазина ответил ошибкой `out_of_service`, то система &laquo;ИнвойсБокс&raquo; будет пытаться повторить этот запрос еще 10 раз в течение последующих суток.
