---
layout: nocompress
nav_order: 2
title: "Схема взаимодействия"
---

# Схема взаимодействия с ИнвойсБокс API v3

## Процесс создания заказа и оплаты

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant ИнвойсБокс 
    rect rgb(204, 245, 204)
      Покупатель->>Магазин: Создает заказ
      Магазин->>ИнвойсБокс: Вызов метода создания заказа
      ИнвойсБокс->>Магазин: Идентификатор заказа и ссылка на оплату
      Магазин->>Покупатель: Перенаправление на платёжную страницу
      Покупатель-->>ИнвойсБокс: Взаимодействие с платёжной страницей, получение счёта
      Покупатель->>ИнвойсБокс: Оплата счёта
      ИнвойсБокс->>Покупатель: Перенаправление покупателя на сайт магазина
      ИнвойсБокс->>Магазин: Уведомление об успешной оплате
    end
</div>


1. Покупатель оформляет заказ на сайте Магазина и выбирает способ оплаты через систему &laquo;ИнвойсБокс&raquo;.
1. Магазин создает в системе &laquo;ИнвойсБокс&raquo; заказ [через метод API](/docs/order/create/).
1. Система возвращает ссылку на платёжную страницу для оплаты заказа.
1. Магазин перенаправляет покупателя по полученной ссылке.
1. Покупатель заполняет необходимые для оплаты сведения и получет счёт для оплаты.
1. Покупатель оплачивает счёт.
1. Система &laquo;ИнвойсБокс&raquo; перенаправляет покупателя обратно на сайт Магазина.
1. Система &laquo;ИнвойсБокс&raquo; оповещает Магазин об успешной оплате заказа.


## Процесс создания возврата

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant ИнвойсБокс 
    rect rgb(204, 204, 255)
      Покупатель->>Магазин: Обращается за возвратом по заказу
      Магазин-->ИнвойсБокс: Получение списка позиций в заказе
      Магазин->>ИнвойсБокс: Вызов метода оформления возврата
      ИнвойсБокс->>Покупатель: Осуществление возврата денежных средств
    end
</div>


1. Покупатель обращается в Магазин для оформления возврата заказа.
1. Опционально, Магазин запрашивает [через метод API](/docs/refund/get/) доступные к возврату позиции в заказе.
1. Магазин создает возврат в системе &laquo;ИнвойсБокс&raquo; заказ [через метод API](/docs/refund/create/).
1. Система &laquo;ИнвойсБокс&raquo; осуществляет возврат денежных средств покупателю.

---

[Читать далее](/docs/order){: .btn .btn-primary .fs-5 .mb-4 .mb-md-0 .mr-2 }
